<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>
  
    <!-- sales order -->
    <template id="report_saleorder_amamedis" 
      inherit_id="sale.report_saleorder_document">
      <xpath expr="//div[@class='page']" position="replace">
        <div class="page">
          <t t-call="report.external_report_sender"/>
 
          <div class="vspace-xs clearleft left" id="addressee">
            <div t-if="not o.partner_id.is_company" 
              t-field="o.partner_id.parent_id.name"/> 
            <div>
              <t t-if="o.partner_id.first_name">
                <span t-field="o.partner_id.first_name"/>
              </t>
              <span t-field="o.partner_id.name"/>
            </div>
            <div t-field="o.partner_id.street"/>
            <div t-if="o.partner_id.street2"
              t-field="o.partner_id.street2"/>
            <p/>
            <span t-field="o.partner_id.zip"/>
            <span t-field="o.partner_id.city"/> 
          </div>
 
          <!-- shipping address != invoice address -->
          <div 
            class="right vspace-xs"
            id="delivery"
            style="max-width:7cm;">
            <p><b>Lieferung an</b></p>
            <div t-if="o.partner_id.parent_id">
              <span t-field="o.partner_id.parent_id.name"/>
            </div>
            <div>
              <t t-if="o.partner_id.first_name">
                <span t-field="o.partner_id.first_name"/>
              </t>
              <span t-field="o.partner_shipping_id.name"/>
            </div>
            <div t-field="o.partner_shipping_id.street"/>
            <div t-if="o.partner_shipping_id.stree2"
              t-field="o.partner_shipping_id.street2"/>
            <span t-field="o.partner_shipping_id.zip"/>
            <span t-field="o.partner_shipping_id.city"/> 
          </div>

          <div class="clearleft clearright vspace-s">
            <span t-if="not o.user_id.name in 'Administrator'" class="right">
              <b>Ansprechpartner:</b>
              <span t-field="o.user_id.name"/>
            </span>
            <table class="bg-grey vspace-m">
              <tr t-if="o.partner_id.bga">
                <td><b>BGA</b></td>
                <td><span t-field="o.partner_id.bga"/></td>
              </tr>
              <tr t-if="o.partner_id.phone">
                <td><b>Ihre Telefonnummer</b></td>
                <td><span t-field="o.partner_id.phone"/></td>
              </tr>
              <tr t-if="o.name">
                <td><br/><b>Ihre Bestellung</b></td>
                <td><br/><span t-field="o.client_order_ref"/></td>
              </tr>
            </table>
          </div>
 
          <div class="fullwidth vspace-l">
            <span class="title hspace-s"
              t-if="o.state not in ['draft','sent']">
              Auftragsbest&amp;auml;tigung Nr.
            </span>
            <span class="title hspace-s"
              t-if="o.state in ['draft','sent']">
              Angebot Nr.
            </span>
            <span class="title hspace-s" t-field="o.name"/>
          </div>
        
         <div t-if="o.date_order" class="right vspace-s" style="margin-bottom:0.6cm;">
           Leipzig, den <span
             t-esc="datetime.datetime.strptime(o.date_order, '%Y-%m-%d %H:%M:%S').strftime('%d.%m.%Y')"/>
          </div>
          
          <table id="positions" class="fullwidth vspace-s">
            <thead>
              <tr>
                <th>Artikelnummer</th>
                <th>Rechnungsposten</th>
                <th class="right">Menge</th>
                <th class="right">Preis/PE</th>
                <th class="right">PE</th>
                <th class="right">Summe</th>
              </tr>
            </thead>
            <tbody class="sale_tbody top">
              <tr t-foreach="o.order_line" t-as="l">
                <td>
                  <span t-field="l.product_id.default_code"/>
                </td>
                <td>
                  <t t-if="'] ' in l.name">
                    <span t-esc="(l.name).split('] ')[1]"/>
                  </t>
                  <t t-if="not '] ' in l.name">
                    <span t-field="l.name"/>
                  </t>
                </td>
                <td class="right">
                  <span t-esc="l.product_uom_qty"/>
                </td>
                <td class="right">
                  <span t-esc="str('%.4f' % l.price_unit).replace('.',',')"/> €
                </td>
                <td class="right">
                  <span t-field="l.product_uom.name"/>
                </td>
                <td class="right">
                  <span t-field="l.price_subtotal"
                    t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                </td>
              </tr>
              
              <tr>
                <td class="tiny">&amp;nbsp;</td>
                <td class="tiny line" colspan="5">&amp;nbsp;</td>
              </tr>
             
              <tr>
                <td>&amp;nbsp;</td>
                <td colspan="4">Zwischensumme netto</td>
                <td class="right">
                  <span t-field="o.amount_untaxed"/> €
                </td>
              </tr>
              <tr>
                <td>&amp;nbsp;</td>
                <td colspan="4">Umsatzsteuer</td>
                <td class="right">
                  <span t-field="o.amount_tax"/> €
                </td>
              </tr>
             
              <tr>
                <td>&amp;nbsp;</td>
                <td class="sum line" colspan="4">Gesamtbetrag</td>
                <td class="sum line right">
                  <span t-field="o.amount_total"/> €
                </td>
              </tr>
            </tbody>
          </table>
          
          <table class="vspace-s">
            <tr t-if="o.carrier_id">
              <td><b>Versandart</b></td>
              <td><span t-field="o.carrier_id.name"/></td>
            </tr>
            <tr t-if="o.incoterm">
              <td><b>Lieferbedingung</b></td>
              <td><span t-field="o.incoterm.name"/></td>
            </tr>
            <tr t-if="o.payment_term">
              <td><b>Zahlungsbedingung</b></td>
              <td><span t-field="o.payment_term.name"/></td>
            </tr>
          </table>

          <t t-if="o.note">
            <div class="small vspace-xs" t-field="o.note"/>
          </t>

          <div t-if="o.section_id" class="small vspace-xs">
            Mit freundlichen Grüßen<br/>
            <span t-field="o.section_id.company_id.partner_id.name"/>
          </div>

        </div>
      </xpath>      
    </template>
  </data>
</openerp>

